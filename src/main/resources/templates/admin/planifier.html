<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Planifier Soutenance</title>
    <!-- CSS li kan 3ndek -->
</head>
<body>
<div class="container">
    <div class="section">
        <h2>ðŸ“… Planifier une nouvelle soutenance</h2>
        <form th:action="@{/admin/soutenances/planifier}" th:object="${soutenance}" method="post">
            
            <!-- Choix Ã‰tudiant et Sujet (mabdelnach) -->
            <select th:field="*{etudiant}">
                <option th:each="etud : ${etudiants}" th:value="${etud.id}" th:text="${etud.nom}"></option>
            </select>
            <!-- ... -->

            <!-- HNA L'CHANGEMENT L'KBIR: Date, Heure, DurÃ©e -->
            <div class="form-group">
                <label>Date de la soutenance:</label>
                <input type="date" id="soutenance_date" required>
            </div>
            <div class="form-group">
                <label>Heure de dÃ©but:</label>
                <input type="time" id="soutenance_heure" required>
            </div>
             <div class="form-group">
                <label>Salle:</label>
                <select id="soutenance_salle" th:field="*{salle}" required>
                    <option th:each="s : ${salles}" th:value="${s.id}" th:text="${s.nom}"></option>
                </select>
            </div>

            <!-- Bouton bach njib l jury l'disponibles -->
            <button type="button" id="findJuryBtn" class="submit-btn">Chercher Jury Disponible</button>

            <!-- La liste dyal Jury Disponibles (ghadi t3emmer b JavaScript) -->
            <div id="jury-list" style="margin-top: 20px;">
                <h3>Jury disponible:</h3>
                <!-- Les checkboxes dyal l jury ghaytzado hna -->
            </div>

            <button type="submit" class="submit-btn">Planifier Soutenance</button>
        </form>
    </div>
</div>

<script>
    document.getElementById('findJuryBtn').addEventListener('click', function() {
        const date = document.getElementById('soutenance_date').value;
        const heure = document.getElementById('soutenance_heure').value;
        
        if (!date || !heure) {
            alert('Veuillez sÃ©lectionner une date et une heure.');
            return;
        }

        // On crÃ©e la date et heure de dÃ©but en format ISO
        const debutStr = date + 'T' + heure;

        // On envoie un appel API pour rÃ©cupÃ©rer les enseignants disponibles
        fetch('/api/admin/enseignants-disponibles?debut=' + debutStr)
            .then(response => response.json())
            .then(data => {
                const juryListDiv = document.getElementById('jury-list');
                juryListDiv.innerHTML = '<h3>Jury disponible:</h3>'; // On vide la liste
                
                if (data.length === 0) {
                    juryListDiv.innerHTML += '<p>Aucun enseignant disponible pour ce crÃ©neau.</p>';
                } else {
                    data.forEach(enseignant => {
                        juryListDiv.innerHTML += `
                            <label>
                                <input type="checkbox" name="juryEnseignants" value="${enseignant.id}">
                                ${enseignant.nom} ${enseignant.prenom}
                            </label><br>
                        `;
                    });
                }
            });
    });
</script>
</body>
</html>