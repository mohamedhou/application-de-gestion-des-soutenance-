<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord - Enseignant</title>
    <!-- On va unifier le style -->
    <style>
        /* Base & Body */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7fa; color: #333; }
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; }

        /* Header */
        .header { background: white; border-radius: 12px; padding: 20px 30px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.06); display: flex; justify-content: space-between; align-items: center; }
        .logo-section { display: flex; align-items: center; gap: 15px; }
        .logo img { width: 120px; height: auto; border-radius: 10px; }
        .welcome-section h1 { color: #1e3a8a; font-size: 24px; font-weight: 600; }
        .welcome-section .subtitle { color: #64748b; font-size: 14px; }
        .header-actions { display: flex; gap: 15px; }
        .action-button { color: white; padding: 10px 20px; border: none; border-radius: 8px; text-decoration: none; font-weight: 500; font-size: 14px; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .action-button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .dispo-btn { background-color: #4f46e5; }
        .logout-btn { background-color: #ef4444; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; border-radius: 12px; padding: 25px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.06); border-top: 4px solid #3b82f6; transition: all 0.3s; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(59,130,246,0.15); }
        .stat-number { font-size: 36px; font-weight: 700; color: #1e3a8a; }
        .stat-label { color: #64748b; font-size: 14px; margin-top: 5px; }
        
        /* Section & Table */
        .section { background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.06); }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #e5e7eb; }
        .section-header h2 { color: #1e3a8a; font-size: 20px; font-weight: 600; }
        .proposer-btn { background: #16a34a; color: white; padding: 8px 16px; border-radius: 6px; font-size: 14px; text-decoration: none; font-weight: 500;}
        table { width: 100%; border-collapse: collapse; }
        table thead { border-bottom: 2px solid #e5e7eb; }
        table th { padding: 12px 0; text-align: left; font-weight: 600; color: #4b5563; font-size: 13px; text-transform: uppercase;}
        table td { padding: 15px 0; border-top: 1px solid #e5e7eb; font-size: 14px;}
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; color: white; }
        .status-validated { background-color: #22c55e; }
        .status-pending { background-color: #f59e0b; }
        .empty-state { text-align: center; padding: 40px; color: #6b7280; background-color: #f9fafb; border-radius: 8px;}

    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <div class="logo-section">
                <!-- Utilisation de votre logo.png -->
                <div class="logo">
                    <img th:src="@{/images/logo.jpg}" alt="Logo FSM">
                </div>
                <div class="welcome-section">
                    <h1>Bienvenue <span th:text="${enseignant.prenom}"></span> <span th:text="${enseignant.nom}"></span>!</h1>
                    <div class="subtitle">Votre espace enseignant - FSM</div>
                </div>
            </div>
            <div class="header-actions">
                <a th:href="@{/enseignant/calendrier-disponibilites}" class="action-button dispo-btn">üìÖ G√©rer Indisponibilit√©s</a>
                <a th:href="@{/logout}" class="action-button logout-btn">D√©connexion</a>
            </div>
        </div>

        <!-- Stats Grid Section -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" th:text="${#lists.size(sujets)}">0</div>
                <div class="stat-label">Sujets Propos√©s</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${#lists.size(soutenancesEncadrees)}">0</div>
                <div class="stat-label">Soutenances Encadr√©es</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${#lists.size(soutenancesJure)}">0</div>
                <div class="stat-label">Participations Jury</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${#lists.size(sujets.?[!valide])}">0</div>
                <div class="stat-label">Sujets en Attente</div>
            </div>
        </div>

        <!-- Mes Sujets Propos√©s Section -->
        <div class="section">
            <div class="section-header">
                <h2>üìù Mes sujets propos√©s</h2>
                <a th:href="@{/enseignant/proposer-sujet}" class="proposer-btn">‚ûï Proposer un Sujet</a>
            </div>
            <div th:if="${#lists.isEmpty(sujets)}" class="empty-state">
                <p>Vous n'avez propos√© aucun sujet pour le moment.</p>
            </div>
            <table th:if="${not #lists.isEmpty(sujets)}">
                <thead><tr><th>Titre</th><th>Description</th><th>Statut</th></tr></thead>
                <tbody>
                    <tr th:each="sujet : ${sujets}">
                        <td th:text="${sujet.titre}"></td>
                        <td th:text="${sujet.description}"></td>
                        <td>
                            <span th:class="${sujet.valide} ? 'status-badge status-validated' : 'status-badge status-pending'"
                                  th:text="${sujet.valide} ? 'Valid√©' : 'En attente'"></span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

		<!-- SECTION: Mes Soutenances Encadr√©es -->
		<div class="section">
		    <div class="section-header"><h2>üë®‚Äçüè´ Mes Soutenances Encadr√©es</h2></div>
		    <div th:if="${#lists.isEmpty(soutenancesEncadrees)}" class="empty-state"><p>Aucune soutenance encadr√©e programm√©e.</p></div>
		    
		    <table th:if="${not #lists.isEmpty(soutenancesEncadrees)}">
		        <thead>
		            <tr>
		                <th>√âtudiant</th>
		                <th>Date & Heure</th>
		                <th>Salle</th>
		                <th>Sujet</th>
		                <th>Actions</th> <!-- <-- ZEDNA COLONNE JDIDA -->
		            </tr>
		        </thead>
		        <tbody>
		            <tr th:each="soutenance : ${soutenancesEncadrees}">
		                <td th:text="${soutenance.etudiant?.prenom + ' ' + soutenance.etudiant?.nom}"></td>
		                <td th:text="${#temporals.format(soutenance.date, 'dd MMMM yyyy, HH:mm')}"></td>
		                <td th:text="${soutenance.salle?.nom}"></td>
		                <td th:text="${soutenance.sujet?.titre}"></td>
		                <td>
		                    <!-- HNA L'I·∏åAFA L'MOHIMMA: KAN'AFFICHIW L'BOUTON GHIR ILA L'RAPPORT KAYN -->
		                    <div th:if="${soutenance.rapport != null}">
		                        <a th:href="@{/enseignant/telecharger-rapport/{id}(id=${soutenance.id})}"
		                           class="action-button"
		                           style="background-color: #4f46e5;"
		                           target="_blank"> <!-- target="_blank" pour ouvrir dans un nouvel onglet -->
		                           üìÑ Consulter Rapport
		                        </a>
		                    </div>
		                    <!-- MESSAGE ILA MAZAL MA KAYN RAPPORT -->
		                    <div th:if="${soutenance.rapport == null}" style="font-size: 13px; color: #6b7280;">
		                        Pas de rapport
		                    </div>
		                </td>
		            </tr>
		        </tbody>
		    </table>
		</div>

        <!-- Mes Soutenances en tant que Jury Section -->
        <div class="section">
            <div class="section-header"><h2>üë®‚Äç‚öñÔ∏è Mes Soutenances en tant que Jury</h2></div>
            <div th:if="${#lists.isEmpty(soutenancesJure)}" class="empty-state"><p>Aucune soutenance programm√©e en tant que jury.</p></div>
            <table th:if="${not #lists.isEmpty(soutenancesJure)}">
                <thead><tr><th>√âtudiant</th><th>Date & Heure</th><th>Salle</th><th>Sujet</th></tr></thead>
                <tbody>
                    <tr th:each="soutenance : ${soutenancesJure}">
                        <td th:text="${soutenance.etudiant?.prenom + ' ' + soutenance.etudiant?.nom}"></td>
                        <td th:text="${#temporals.format(soutenance.date, 'dd MMMM yyyy, HH:mm')}"></td>
                        <td th:text="${soutenance.salle?.nom}"></td>
                        <td th:text="${soutenance.sujet?.titre}"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>