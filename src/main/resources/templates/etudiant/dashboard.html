<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Tableau de bord Étudiant</title>
</head>
<body>
    <h1>Bienvenue <span th:text="${etudiant.nom}"></span>!</h1>
    <a href="/logout">Déconnexion</a>
    
    <div th:if="${param.success}">
        <div th:switch="${param.success}">
            <p th:case="'rapport_soumis'">Rapport soumis avec succès!</p>
        </div>
    </div>
    
    <div th:if="${param.error}">
        <div th:switch="${param.error}">
            <p th:case="'no_soutenance'">Aucune soutenance planifiée</p>
            <p th:case="'upload_failed'">Échec du téléversement du rapport</p>
        </div>
    </div>
    
    <div th:if="${!hasSujet}">
        <h2>Sujets disponibles</h2>
        <table border="1">
            <tr>
                <th>Titre</th>
                <th>Description</th>
                <th>Action</th>
            </tr>
            <tr th:each="sujet : ${sujets}">
                <td th:text="${sujet.titre}"></td>
                <td th:text="${sujet.description}"></td>
                <td><a th:href="@{/etudiant/choisir-sujet/{id}(id=${sujet.id})}">Choisir</a></td>
            </tr>
        </table>
    </div>
    
    <div th:if="${hasSujet}">
        <h2>Mon sujet</h2>
        <p>Titre: <span th:text="${etudiant.sujet.titre}"></span></p>
        <p>Description: <span th:text="${etudiant.sujet.description}"></span></p>
        
        <div th:if="${soutenance}">
            <h2>Ma soutenance</h2>
            <p>Date: <span th:text="${#temporals.format(soutenance.date, 'dd/MM/yyyy')}"></span></p>
            <p>Heure: <span th:text="${#temporals.format(soutenance.date, 'HH:mm')}"></span></p>
            <p>Salle: <span th:text="${soutenance.salle.nom}"></span></p>
            
            <div>
                <a th:href="@{/etudiant/telecharger-convocation}">Télécharger la convocation</a>
            </div>
            
            <div>
                <a th:href="@{/etudiant/consulter-soutenance}">Consulter les détails de la soutenance</a>
            </div>
            
            <div th:if="${!hasRapport}">
                <a th:href="@{/etudiant/soumettre-rapport}">Soumettre mon rapport</a>
            </div>
            <div th:if="${hasRapport}">
                <p>Rapport déjà soumis</p>
            </div>
        </div>
        <div th:unless="${soutenance}">
            <p>Votre soutenance n'a pas encore été planifiée</p>
        </div>
    </div>
</body>
</html>